# 027. User Datagram Protocol
### ■ UDP
![UDP]( https://raw.githubusercontent.com/taechacode/ComputerScienceRepository/master/Computer%20Network/images/CN_027_01.PNG)
<br><br>
&nbsp;전송 계층의 대표적인 프토로콜에는 TCP와 UDP가 있다. TCP는 여러 가지 신뢰성 있는 전송을 제공하기 위한 기능들을 가지고 있다. 반면에 `UDP(User Datagram Protocol)`은 매우 `단순한 프로토콜`이고 실제 데이터의 헤더 부분도 간단하게 구성되어 있다. 둘 중에 구성이 간단한 UDP부터 살펴보자.
<br><br>
&nbsp;`UDP`는 `User Datagram Protocol`의 약자로 흔히 장식이 달려 있지 않은 뼈만 있는 프로토콜이라고 표현한다. `어떤 부가적인 기능 없이 전송 계층 프로토콜의 기본적인 기능인 멀티플렉싱, 디멀티플렉싱만 거의 제공`하기 때문에 나온 말이다. 그리고 TCP와 달리 어떤 connection을 설정하고 데이터를 보내지 않기 때문에 `Connectionless service`라고 얘기한다.
<br><br>
&nbsp;특별한 어떤 connection을 설정하고 거기에 연달아서 데이터를 보내는 형태가 아니기에 `각각의 UDP Segment들은 독립적`으로 취급이 된다. 그래서 서비스가 각각 이루어지기 때문에 `에러가 포함`되어 있을 수도 있고 `순서가 뒤바뀔 수도 있어 비신뢰적`이다.
<br><br>
&nbsp;지금까지 나열한 UDP의 특징들만 보면 전체적으로 단점 밖에 없는 것 같은데 `UDP가 TCP보다 좋은 점은 속도가 빠르다`는 것이다. 그렇다 보니 UDP는 에러가 포함되더라도 속도가 빨라야 하는 응용 프로그램의 통신에 많이 사용된다. 예를 들어, 스트리밍 멀티미디어나 사이트 URL 주소를 알아내는 DNS, 네트워크 관리 프로토콜인 SNMP(Simple Network Management Protocol) 등이 있다.
<br><br>
&nbsp;그렇다면 UDP에서는 신뢰성 있는 서비스를 제공하지 못하는 것일까? `UDP 자체에는 신뢰성을 위한 기능이 없다`. UDP는 전송 계층의 프로토콜이기 때문에 하위 계층인 네트워크 계층의 인터넷 프로토콜이 제공하는 정도의 신뢰성을 사용한다. 그래서 만약에 UDP를 사용하는 어떤 애플리케이션이 신뢰성이 필요하다면 그 부분을 해당 애플리케이션 개발자가 직접 구현을 해야 한다.
<br><br>
&nbsp;UDP에는 `체크섬(Checksum)`이라고 하여 Segment에 에러가 포함되어 있는지 여부 정도의 정보를 간단하게 알려주는 정보가 있다. 그 정보를 기반으로 애플리케이션이 직접적으로 재전송을 요구하거나, 거기에 맞는 에러 보정을 하게끔 개발자가 따로 만들어서 애플리케이션 통신의 신뢰성을 높일 수 있다.
<br>
### ■ UDP Segment Header
![UDP Segment Header]( https://raw.githubusercontent.com/taechacode/ComputerScienceRepository/master/Computer%20Network/images/CN_027_02.PNG)
<br><br>
&nbsp;UDP도 어떤 서비스를 제공하기 위해서는 정보가 있어야 하고, 그 정보는 데이터를 보내는 쪽에서 UDP Segment를 만들어서 데이터를 담아서 보낼 때 앞쪽의 헤더에 담기게 된다.
<br><br>
&nbsp;UDP는 계속 언급했듯이 `매우 간단한 헤더(Header)`를 가지고 있다. UDP Segment의 한 단위를 `워드(Word)`라고 하고 이 워드는 `4byte`, bit로 환산하면 `32bit`의 크기를 가지고 있다. 전송 계층의 가장 기본적인 기능은 멀티플렉싱과 디멀티플렉싱이기 때문에 이것을 수행하기 위한 `포트 넘버`가 상단에 위치해있다. 여기에는 데이터를 보내는 프로세스의 포트 넘버 16bit, 받는 프로세스의 포트 넘버 16bit가 담겨있다.
<br><br>
&nbsp;그 다음으로는 `길이(Length)`가 포함되어 있다. 포트 넘버가 담겨 있는 헤더의 위 부분이 4byte, 그리고 길이와 체크섬이 담겨 있는 헤더의 아래 부분이 4byte, 그리고 그 아래 데이터들을 합한 크기가 길이 정보에 담기게 된다.
<br><br>
&nbsp;체크섬은 나중에 따로 알아보고 UDP의 장점에 대해 알아보자. UDP의 장점 중 하나는 `Simple`이다. TCP 프로토콜의 헤더와 비교하면 UDP 헤더는 매우 간단하게 구성되어 있으며 이는 그만큼 `처리 속도가 빨라질 수 있다`는 것을 의미한다. 그리고 데이터를 송수신할 때 connection을 설립하지 않기 때문에 거기서 드는 `지연 시간도 절약`할 수 있다. Segment의 헤더 크기도 TCP에 비해 40% 미만의 `작은 크기`를 갖는다. 헤더는 데이터를 보낼 때마다 붙여야 하는데 그만큼 헤더의 크기가 작아지면 네트워크 입장에서의 부담이 적어지는 장점이 있다.
<br><br>
&nbsp;UDP 또다른 장점으로는 TCP는 `Congestion control`이라는 것이 있는데 UDP는 없다는 것이다. Congestion이라는 것은 혼잡이라는 의미이며 네트워크가 처리할 수 없을 만큼의 데이터 부하가 걸려서 네트워크가 제 기능을 하지 못하는 현상을 뜻한다. TCP에서는 네트워크의 혼잡한 상황을 제어하기 위해 데이터 송신 측의 전송 속도를 줄이게 만드는 방법을 사용하기도 한다. UDP는 그런 기능이 없어서 응용 프로그램이 자신이 보내려고 하는 데이터가 있으면 `혼잡 제어를 상관하지 않고 원하는 만큼 데이터를 보낼 수 있다`. 예를 들어, 비디오 스트리밍 서비스에서 많은 수의 사용자가 고화질 비디오 데이터를 원한다면 서비스 회사에서 혼잡 제어 상황을 상관하지 않고 사용자들이 원하는 만큼 데이터를 보내줄 수 있다.
<br>
### ■ UDP Checksum
![UDP Checksum]( https://raw.githubusercontent.com/taechacode/ComputerScienceRepository/master/Computer%20Network/images/CN_027_03.PNG)
<br><br>
&nbsp;앞서 따로 알아보기로 했었던 UDP 헤더의 필드 중 하나인 `체크섬(Checksum)`에 대해서 살펴보자. 체크섬은 간단하게 말해서 `UDP Segment 전체에 에러가 포함되어 있는지를 확인해주는 필드`이다. UDP는 분명 비신뢰적인 서비스를 제공하긴 하지만 적어도 에러가 포함되어 있는지 정도의 여부를 가려내는 최소한의 정보를 체크섬을 통해 제공하는 것이다. 그래서 당장에 UDP에는 신뢰성 기능이 없더라도 개발자가 체크섬을 통해 에러의 여부를 확인한 후 데이터 처리 방식에 대해 응용 프로그램에서 어떤 작업을 취할 지 따로 기능 확장을 할 수 있는 가능성이 열려있다.
<br><br>
&nbsp;체크섬도 헤더의 다른 필드들과 같이 4byte의 크기를 갖는다. 데이터를 보내는 쪽에서 어떤 규칙에 의해서 체크섬을 만들면, 데이터를 받는 쪽에서는 받은 데이터를 기반으로 같은 규칙을 사용해 체크섬을 다시 생성해본다. 만약 `보내는 쪽이 가지고 있는 체크섬과 받는 쪽이 생성한 체크섬이 일치하면 전송 중의 Segment에 문제가 발생하지 않은 것`이다. 반대로 `차이가 발생한다면 Segment의 일부 정보가 변경되었음`을 알 수 있다. 
<br>
### ■ 인터넷 체크섬 예시
![인터넷 체크섬 예시]( https://raw.githubusercontent.com/taechacode/ComputerScienceRepository/master/Computer%20Network/images/CN_027_04.PNG)
<br><br>
&nbsp;UDP에서 체크섬이 어떻게 만들어지는지 살펴보자. 이 내용은 UDP에만 쓰이는 것이 아니라 TCP에서도 똑같은 방식으로 이루어진다. 처음에 헤더의 첫 번째 부분에 있는 소스 포트(Source port)부터 데스티네이션 포트(Destination port)까지 길이가 32bit이다. 중간에 16bit 단위로 데이터를 보내는 쪽에서 자른다. 그리고 잘라진 2개의 16bit를 겹쳐 두고 위의 그림처럼 `합산`을 진행한다. 합산을 하게 되면 `올림(Carry)`이 발생할 수도 있다. 올림이 발생하면 이 올림된 1을 가장 아래 자리로 내려서 합산을 한다. 그리고 헤더의 포트 넘버 다음에 있는 필드들을 16bit 단위로 잘라서 계속 합산한다.
<br><br>
&nbsp;UDP Segment에 있는 모든 필드들을 합산했으면 마지막에 `1의 보수`를 취해준다. 1의 보수를 취하는 것은 단순히 0을 1로, 1을 0으로 바꿔주면 된다. 그리고 이것을 체크섬 필드에 담으면 체크섬이 완성된다. 처음에는 체크섬이 생성되어 있지 않기 때문에 체크섬 필드는 0으로 채워져 있는데, 이후 0 대신 만들어진 체크섬 값을 체크섬 필드에 담아준다.
<br><br>
&nbsp;그런데 왜 Segment의 모든 필드를 합산한 후에 1의 보수를 취하는 것일까? 가령 데이터 수신자가 송신자가 만든 Segment의 필드들을 모두 합산한다고 생각해보자. 수신자가 받은 Segment는 송신자가 체크섬을 만들어서 넣어두었기 때문에 체크섬에 0이 들어있지 않고 합산 후 1의 보수를 취한 체크섬이 들어있다. 그래서 수신자가 모든 필드를 합산하면 16bit가 모두 1인 값이 나오게 된다. (`"체크섬을 제외한 필드들의 합" + "체크섬을 제외한 필드들의 합"의 1의 보수 = "16bit 전부 1"`) 모두 1이 나온다는 것은 송신자가 보낸 Segment가 통신 도중 정보의 변경 없이 수신자에게 잘 도착했다는 뜻이다. 반대로 수신자가 계산을 했는데 체크섬 16bit가 전부 1이 나오지 않는다면 데이터가 변경이 일어난 것임을 알 수 있다.
<br><br><br>
###### <span style="color:#666666">※ 본 정리 내용은 부산대학교 유영환 교수님의 컴퓨터 네트워킹 수업을 정리한 것입니다.<br>※※ 강의에 사용된 교재 : [Computer Networking A Top-Down Approach 7th edition / Jim Kurose, Keith Ross]</span>
